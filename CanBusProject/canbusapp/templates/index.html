<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <title>CANBUS</title>  
    {% load static %}  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />

<!--    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>-->
    <script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>

    
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">  
    <script src="{% static 'js/bootstrap.min.js' %}"></script>

    <link rel="stylesheet" href="static/css/style.css">
</head>  
<body>  
     <div class="container">
        <main>
           {% block nameteble %}
           {%endblock%}
           <div class="info-send">
               <div class="center">
                   <div class="table-responsive">
                       <div class="tableFixHead">
                           <table class="table table-hover" id="refresh-table">
                                <thead class="header">
                                    <tr>
                                        <th>ID</th>
                                        <th>DLC</th>
                                        <th>DATA</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% block tableData %}
                                    {% endblock%}
                                </tbody>
                            </table>
                       </div>
                   </div>
               </div>
           </div>
       </main>
     </div>
<!--       <div class="right">-->
<!--            <div class="control_panel">-->
<!--                <h2>Control panel</h2>-->
<!--                <div class="controls">-->
<!--                    <div class="control">-->
<!--                        <h4>Start data sending</h4>-->
<!--                        <button type="button" class="btn btn-info" id="{{ interface }}startId" name="{{ interface }}start">Start {{ interface }}</button>-->
<!--                    </div>-->
<!--                    <div class="control">-->
<!--                        <h4>Stop data sending</h4>-->
<!--                        <button type="button" class="btn btn-danger" id="{{ interface }}stopId" name="{{ interface }}stop">Stop {{ interface }}</button>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--       </div>-->
<!--     </div>-->
<script type="text/javascript">
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // const csrftoken = Cookies.get('csrftoken');

    $('#vcan0startId').click(function() {
        $.ajax({
            url: '/vcan0',
            headers: {'X-CSRFToken': getCookie('csrftoken')},
            method: 'POST',
            data: {
                click: true,
                'operation': "startsending"
            },
            success: function (data) {
                console.log('VCAN0: start sending')
                alert('VCAN0: start sending')
                // Refresh the Table every 3 seconds
                setInterval(function(){
                    $.ajax({
                       url: '/vcan0',
                       headers: {'X-CSRFToken': getCookie('csrftoken')},
                          success: function(data) {
                          $('#refresh-table').html($(data).find('#refresh-table').html());
                          }
                    });
                }, 3000)
            },
            error: (error) => {
                console.log(error);
            }
            });

    });

    $('#vcan0stopId').click(function() {
    $.ajax({
        url: '/vcan0',
        headers: {'X-CSRFToken': getCookie('csrftoken')},
        method: 'POST',
        data: {
            click: true,
            'operation': "stopsending"
        },
        success: function (data) {
            console.log('VCAN0: stop sending')
            alert('VCAN0: stop sending')
            // location.reload();
            // clearInterval(autoRefreshTable)
        },
        error: (error) => {
            console.log(error);
        }
        });
    });
</script>
</body>
</html>

